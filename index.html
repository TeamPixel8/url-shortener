<!DOCTYPE html>
<html>
<head>
  <title>Redirecting...</title>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <p>Redirecting you...</p>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDXikZ9A8NQGpOBSDpspoDIAhHwULxS7kw",
      authDomain: "url-shortener-a6876.firebaseapp.com",
      projectId: "url-shortener-a6876",
      storageBucket: "url-shortener-a6876.firebasestorage.app",
      messagingSenderId: "104431556924",
      appId: "1:104431556924:web:430305b1fb6885f4852639",
      measurementId: "G-WD3LVT2QY3"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const params = new URLSearchParams(window.location.search);
    const code = [...params.keys()][0]; // get the first query key

    if (code) {
      db.collection("urls").doc(code).get().then(doc => {
        if (doc.exists) {
          const originalUrl = doc.data().original;
          window.location.href = originalUrl;
        } else {
          document.body.innerHTML = "<h2>Invalid link 😢</h2>";
        }
      }).catch(error => {
        console.error("Error getting document:", error);
        document.body.innerHTML = "<h2>Something went wrong 😬</h2>";
      });
    } else {
      document.body.innerHTML = "<h2>No short code found 🤷‍♂️</h2>";
    }
  </script>
</body>
</html>